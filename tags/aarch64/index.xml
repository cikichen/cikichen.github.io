<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Aarch64 - Tag - 编程心语</title>
        <link>https://www.ithome.me/tags/aarch64/</link>
        <description>Aarch64 - Tag - 编程心语</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><copyright>©{year}, All Rights Reserved. Simon Chen</copyright><lastBuildDate>Tue, 06 Apr 2021 00:00:00 &#43;0000</lastBuildDate><atom:link href="https://www.ithome.me/tags/aarch64/" rel="self" type="application/rss+xml" /><item>
    <title>解决MacBook M1下无法运行uiautomatorviewer</title>
    <link>https://www.ithome.me/post/2021/04/06/%E8%A7%A3%E5%86%B3macbook-m1%E4%B8%8B%E6%97%A0%E6%B3%95%E8%BF%90%E8%A1%8Cuiautomatorviewer/</link>
    <pubDate>Tue, 06 Apr 2021 00:00:00 &#43;0000</pubDate>
    <author>Simon</author>
    <guid>https://www.ithome.me/post/2021/04/06/%E8%A7%A3%E5%86%B3macbook-m1%E4%B8%8B%E6%97%A0%E6%B3%95%E8%BF%90%E8%A1%8Cuiautomatorviewer/</guid>
    <description><![CDATA[<p>MacBook使用ARM芯片后虽然带来了性能和续航的提升，但是也带来了不少兼容性问题，好在发布几个月后主流的开发工具都慢慢适配完毕，然而一些小众的工具迟迟无法引来更新。所以<code>Rosetta 2</code>模式仍然非常重要。</p>
<p>默认情况下，我们执行<code>./uiautomatorviewer</code>会报错:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">SWT</span> <span class="n">folder</span> <span class="s1">&#39;/Users/xxx/Library/Android/sdk/tools/lib/aarch64&#39;</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Please</span> <span class="k">export</span> <span class="n">ANDROID_SWT</span> <span class="n">to</span> <span class="n">point</span> <span class="n">to</span> <span class="n">the</span> <span class="n">folder</span> <span class="n">containing</span> <span class="n">swt</span><span class="o">.</span><span class="n">jar</span> <span class="k">for</span> <span class="n">your</span> <span class="n">platform</span><span class="o">.</span>
</span></span></code></pre></div><p>意思是<code>lib</code>下没有<code>aarch64</code>这个目录。</p>
<p>尝试方案1：
在<code>lib</code>下建立<code>aarch64</code>目录，网上找<code>aarch64</code>版本的<code>swt.jar</code>，无果。
最终报错如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">Exception</span> <span class="ow">in</span> <span class="n">thread</span> <span class="s2">&#34;main&#34;</span> <span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">UnsatisfiedLinkError</span><span class="p">:</span> <span class="n">Could</span> <span class="ow">not</span> <span class="nb">load</span> <span class="n">SWT</span> <span class="n">library</span><span class="o">.</span> <span class="n">Reasons</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">no</span> <span class="n">swt</span><span class="o">-</span><span class="n">cocoa</span><span class="o">-</span><span class="mi">4936</span><span class="n">r26</span> <span class="ow">in</span> <span class="n">java</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">path</span>
</span></span><span class="line"><span class="cl">	<span class="n">no</span> <span class="n">swt</span><span class="o">-</span><span class="n">cocoa</span> <span class="ow">in</span> <span class="n">java</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">path</span>
</span></span><span class="line"><span class="cl">	<span class="n">Can</span><span class="s1">&#39;t load library: /Users/xxx/.swt/lib/macosx/aarch64/libswt-cocoa-4936r26.jnilib</span>
</span></span><span class="line"><span class="cl">	<span class="n">Can</span><span class="s1">&#39;t load library: /Users/xxx/.swt/lib/macosx/aarch64/libswt-cocoa.jnilib</span>
</span></span><span class="line"><span class="cl">	<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">xxx</span><span class="o">/.</span><span class="n">swt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">macosx</span><span class="o">/</span><span class="n">aarch64</span><span class="o">/</span><span class="n">libswt</span><span class="o">-</span><span class="n">cocoa</span><span class="o">-</span><span class="mi">4936</span><span class="n">r26</span><span class="o">.</span><span class="n">jnilib</span><span class="p">:</span> <span class="n">dlopen</span><span class="p">(</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">xxx</span><span class="o">/.</span><span class="n">swt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">macosx</span><span class="o">/</span><span class="n">aarch64</span><span class="o">/</span><span class="n">libswt</span><span class="o">-</span><span class="n">cocoa</span><span class="o">-</span><span class="mi">4936</span><span class="n">r26</span><span class="o">.</span><span class="n">jnilib</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">no</span> <span class="n">suitable</span> <span class="n">image</span> <span class="n">found</span><span class="o">.</span>  <span class="n">Did</span> <span class="n">find</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">xxx</span><span class="o">/.</span><span class="n">swt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">macosx</span><span class="o">/</span><span class="n">aarch64</span><span class="o">/</span><span class="n">libswt</span><span class="o">-</span><span class="n">cocoa</span><span class="o">-</span><span class="mi">4936</span><span class="n">r26</span><span class="o">.</span><span class="n">jnilib</span><span class="p">:</span> <span class="n">mach</span><span class="o">-</span><span class="n">o</span><span class="p">,</span> <span class="n">but</span> <span class="n">wrong</span> <span class="n">architecture</span>
</span></span><span class="line"><span class="cl">	<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">xxx</span><span class="o">/.</span><span class="n">swt</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">macosx</span><span class="o">/</span><span class="n">aarch64</span><span class="o">/</span><span class="n">libswt</span><span class="o">-</span><span class="n">cocoa</span><span class="o">-</span><span class="mi">4936</span><span class="n">r26</span><span class="o">.</span><span class="n">jnilib</span><span class="p">:</span> <span class="n">mach</span><span class="o">-</span><span class="n">o</span><span class="p">,</span> <span class="n">but</span> <span class="n">wrong</span> <span class="n">architecture</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">swt</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">Library</span><span class="o">.</span><span class="n">loadLibrary</span><span class="p">(</span><span class="n">Library</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">338</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">swt</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">Library</span><span class="o">.</span><span class="n">loadLibrary</span><span class="p">(</span><span class="n">Library</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">257</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">swt</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">C</span><span class="o">.&lt;</span><span class="n">clinit</span><span class="o">&gt;</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">19</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">swt</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">cocoa</span><span class="o">.</span><span class="n">NSMutableArray</span><span class="o">.</span><span class="n">arrayWithCapacity</span><span class="p">(</span><span class="n">NSMutableArray</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">39</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">swt</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Canvas</span><span class="o">.&lt;</span><span class="n">clinit</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Canvas</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">55</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">jface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">createShell</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">487</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">jface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">430</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">jface</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">790</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="n">android</span><span class="o">.</span><span class="n">uiautomator</span><span class="o">.</span><span class="n">UiAutomatorViewer</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">UiAutomatorViewer</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">78</span><span class="p">)</span>
</span></span></code></pre></div><p>折腾许久也没找到解决方案，放弃。</p>
<p>尝试方案2：
既然增加<code>aarch64</code>支持的方案无法解决，那就只能尝试<code>Rosetta 2</code>方式了。
运行<code>arch -x86_64 ./uiautomatorviewer</code>无效果。</p>
<p><code>uiautomatorviewer</code>依赖<code>Java环境</code>，我使用的是zulu arm版本<code>jdk</code>，所以切换<code>jdk</code>为x64版本。
<code>export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_281.jdk/Contents/Home</code></p>
<p>然后再次执行<code>./uiautomatorviewer</code>，成功运行。</p>]]></description>
</item>
</channel>
</rss>
